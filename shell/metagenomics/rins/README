This is a README file for RINS

RINS (Rapid Identification of Non-human Sequence) is a software tool that detects non-human sequences (virus or other micobails) from human RNA-seq data
This tool could also be used to detect non-X species's sequence from X RNA-seq data if corresponding dataset is provided

The software is developed by Kun Qu and Aparna Bhaduri in Dr. Paul Khavari's Lab in Stanford Dermatology

This README file contains 6 parts:

Part 1. Pre-required software packages:

One has to install the following software packages before he/she can use RINS. For technical support on these applications, please look to their documentation. Detailed installation instructions will also be included there. 

(1) blast-suite 

download from http://blast.ncbi.nlm.nih.gov/Blast.cgi?CMD=Web&PAGE_TYPE=BlastDocs&DOC_TYPE=Download and follow the directions carefully for installation and database formatting 

(2) blatSuite

Follow the links from here: http://genome.ucsc.edu/FAQ/FAQblat.html#blat3 and install based on your system specifications

(3) bowtie

download from http://bowtie-bio.sourceforge.net/index.shtml
and follow the instructions to install

(4) Trinity
download from http://trinityrnaseq.sourceforge.net/
and follow the instructions to install


Part 2. Pre-required datasets

(1) human genome in fasta format (e.g. hg18.fa or hg19.fa) [optional, required for a streamlined BLAST human db, otherwise you can just download the human genomic formatted db from BLAST directly] 
download from http://hgdownload-test.cse.ucsc.edu/goldenPath/hg18/chromosomes/ or http://hgdownload.cse.ucsc.edu/goldenPath/hg19/bigZips/

human genome bowtie index format [required]
downlaod from http://bowtie-bio.sourceforge.net/index.shtml or one can build using "bowtie-build" from a provided fasta file

human genome blast index format (select human_genomic.gz) [optional, can format your own]
download from ftp://ftp.ncbi.nlm.nih.gov/blast/documents/blastdb.html or one can build using "formatdb -i hg18.fa -p F -o T" (older version) or "makeblastdb -in hg18.fa -dbtype nucl -out hg18" (most recent version)

human genome in fasta, bowtie indexes and blast indexes files are pre-included in rins/indexes folder


(2) non human species' genome in fasta format (here we provide virus.fa which contains 32102 virus genomes)

non human species' genome in blast index [a formatted BLAST db comes in several parts]

This reference can be any set of genomes which you are interested in discovering in your dataset. The genomes provided were obtained from NCBI and the ICTV from the NCBI website. 

virus genome files with both .fasta and blast index format are included in rins/indexes folder


Part 3. Installation and usage

(1) uncompress rins.tar.gz to some directory
"tar -zxvf rins.tar.gz"

(2) add rins directory to your $PATH

(3) make perl script executable
"chmod 755 rins_directory/bin/*.pl

(4) edit "config.txt" file and make sure you have everything filled. [Detailed Description below]

(5) to run rins, type:

rins.pl -c config.txt -o result.txt

RINS should be run from a directory in which you want the outputs to be deposited. RINS will email you upon completion at the email address you provide in the config file. 


Part 4. How to check the results

Two relevant output files will be in the directory from which you ran RINS upon completion: 

(1) result.txt 
This file will contain the contigs that have mapped to your nonhuman genome of interest. In tab delimited format it will contain: 

1) The contig that was matched
2) The number of reads supporting this contig (as determined by mapping back to your contig with the original read set)
3) The nonhuman sequence that was identified by BLAST
4) the BLAST E-value
5) the BLAST bit score

This results file may contain one contig that has multiple hits based upon different e-values. 

(2) candidate_non_human.txt
	This file is recommended for advanced users. This file will output the results that have been obtained prior to Trinity assembly, giving a list of potential nonhuman candidates and the number of reads that mapped to this virus. This is a very non-stringent method of evaluating candidates as hits are generated by the blat alignment step, and are only filtered to remove reads that were lost to LZW Compression and alignment to the human genome. There are no limitations on how many times a single read can be counted towards different candidates (one read can be counted only once towards the same virus). This file is meant for informative purposes only as it may be prone to false positives. However, this file may be useful in identifying candidates with expression too low or with spurious/insignificant read coverage to generate a contig from Trinity. 


Part 5. Step of RINS

1) Chop reads into 25mers (or length as specified)
2) Align 25mers reads to nonhuman reference genomes with blat
	Eliminate duplicates caused by cutting reads
3) Compress reads with LZW compression to eliminate repeat regions
4) Align to human genome and subtract hits
5) Assemble into contigs with Trinity
6) Remove human contigs with BLAST
7) Map back to nonhuman contigs with original read set and iteratively extend



Part 6. Detailed config.txt explanation

###########################################################################
#
# Configuration file for RINS command line run
#
# Please give the Whole Path of a file, and do not include space in file names
#
# example as follows
#
# Please fill all the required parameters
#
###########################################################################
# file format and names
# file format can be either "fasta" or "fastq"

file_format = fasta

# if pair-end then "pair_end = 1", else, "pair_end = 0"
# if pair-end, privide file names for both ends, and leave singlelane_filename as NA
# else, provide file name of the single end and leave rightlane/leftlane_filename as NA

pair_end = 1

leftlane_filename = /seq/rins/test_sample/testset_forkun_1.fa
rightlane_filename = /seq/rins/test_sample/testset_forkun_2.fa
singlelane_filename = NA


# email notification

mailto  = kqu@stanford.edu


# reference files of human and non-human species (here virus)
blat_reference = /seq/rins/indexes/virus.fa
bowtie_index_human     = /seq/rins/indexes/hg18


# scripts and executable directories

# rins script directory
scripts_directory = /seq/rins/bin/


# blat bineray path
blat_bin = /seq/blatSuite/blat


# bowtie and bowtie-build bineray
bowtie_bin         = /seq/bowtie-0.12.6/bowtie
bowtie_build_bin  = /seq/bowtie-0.12.6/bowtie-build


# bowtie options

# number of CPUs used for bowtie
bowtie_threads  = 6

#number of mismatches
bowtie_mismatch = 3


# Trinity perl script and Trinity options
trinity_script = /seq/trinity/Trinity.pl
paired_fragment_length = 300
min_contig_length = 300
trinity_threads =  6


# blastn bineray, indexes and options
blastn_bin = /usr/local/ncbi/blast/bin/blastn
blastn_index_human = /seq/rins/indexes/hg18
blastn_index_non_human = /seq/rins/indexes/virus
blastn_evalue_thrd = 0.05


# similarity_thrd shoud between 0.8 - 1.0
similarity_thrd = 0.8 


# modifiable parameters with recommened values

# number of iterations 
iteration = 3

# raw_read_length of your input sequences
raw_read_length = 100

# chopped to this length, 25 is recommended
chop_read_length = 25

# minIdentity option in blat, 80 is recommended
minIdentity = 80

# compress_ratio when LZW is performed, 0.5 is recommended
compress_ratio_thrd = 0.5

